<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Calculate water quality guidlines for polycyclic aromatic hydrocarbons (PAHs) for a specific location, taking into account the phototoxicity of specific PAHs at a given depth. Light absorption at depth is calculated using the TUV model (https://github.com/NCAR/TUV).">
<title>Calculate site-specific water quality guidelines for PAHs • pahwq</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Calculate site-specific water quality guidelines for PAHs">
<meta property="og:description" content="Calculate water quality guidlines for polycyclic aromatic hydrocarbons (PAHs) for a specific location, taking into account the phototoxicity of specific PAHs at a given depth. Light absorption at depth is calculated using the TUV model (https://github.com/NCAR/TUV).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">pahwq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/sensitivity.html">Sensitivity Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bcgov/pahwq/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="pahwq">pahwq<a class="anchor" aria-label="anchor" href="#pahwq"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Implementation of the Photoxic Lipid Model (PTLM) for the calculation of Canadian Water Quality Guidelines for Polycyclic Aromatic Hydrocarbons (PAH).</p>
<p>This package uses the Tropospheric Ultraviolet and Visible (TUV) Radiation Model (<a href="https://github.com/NCAR/TUV" class="external-link uri">https://github.com/NCAR/TUV</a>) to calculate the light penetration through water of a given depth at a given location, with a specified Dissolved Organic Carbon concentration. The light exposure is then used (along with the PAH-specific molar absorption across a range of wavelengths), to calculate the light absorption (Pabs) of the given PAH at that location. This is then used to determine the PLC50.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h3>
<p>On Windows, you need to install <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a>. Make sure that you install the appropriate version for your version of R (i.e. Rtools 4.0 for R 4.0.x, Rtools 4.3 for R 4.3.x, etc.). This will install a compiler toolchain on your computer (specifically <code>gfortran</code>) which is necessary to compile the Fortran code for the TUV model.</p>
</div>
<div class="section level3">
<h3 id="mac">Mac<a class="anchor" aria-label="anchor" href="#mac"></a>
</h3>
<p>On a Mac, the easiest way to get started is to use <a href="https://brew.sh/" class="external-link">Homebrew</a>, and install <code>gcc</code>, which includes <code>gfortran</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>brew install gcc</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="install-pahwq">Install pahwq<a class="anchor" aria-label="anchor" href="#install-pahwq"></a>
</h3>
<p>Once you have Rtools (Windows) or <code>gcc</code> (Mac), you can install the package with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"bcgov/pahwq"</span><span class="op">)</span></span></code></pre></div>
<p><em>Note: You may get some warnings when you install the package - these are from the Fortran compiler because the Fortran code is quite old and does not fully conform to modern standards. These warnings do not affect the package functionality or accuracy.</em></p>
</div>
</div>
<div class="section level2">
<h2 id="example-usage">Example usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<p>To calculate the acute phototoxic water quality guideline (PLC50) for Anthracene at 0.25 m depth in Okanagan Lake on June 21, 2023, with a measured DOC of 5 g/m^3, you can use the following code:</p>
<ol style="list-style-type: decimal">
<li>Load the pahwq package:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bcgov/pahwq" class="external-link">pahwq</a></span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Run the TUV model at your location to determine the incident light intensity across the wavelength spectrum, at each time stamp within the time window specified:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tuv.html">tuv</a></span><span class="op">(</span></span>
<span>  depth_m <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  lat <span class="op">=</span> <span class="fl">49.601632</span>,</span>
<span>  lon <span class="op">=</span> <span class="op">-</span><span class="fl">119.605862</span>,</span>
<span>  DOC <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2023-06-21"</span>,</span>
<span>  tzone <span class="op">=</span> <span class="op">-</span><span class="fl">8L</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">irrad</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wl wavelength_start wavelength_end Kd_lambda t_00.00.00 t_01.00.00</span></span>
<span><span class="co">#&gt; 1 280            279.5          280.5      31.5          0          0</span></span>
<span><span class="co">#&gt; 2 281            280.5          281.5      31.0          0          0</span></span>
<span><span class="co">#&gt; 3 282            281.5          282.5      30.4          0          0</span></span>
<span><span class="co">#&gt; 4 283            282.5          283.5      29.9          0          0</span></span>
<span><span class="co">#&gt; 5 284            283.5          284.5      29.3          0          0</span></span>
<span><span class="co">#&gt; 6 285            284.5          285.5      28.8          0          0</span></span>
<span><span class="co">#&gt;   t_02.00.00 t_03.00.00 t_04.00.00 t_05.00.00 t_06.00.00 t_07.00.00 t_08.00.00</span></span>
<span><span class="co">#&gt; 1          0          0   3.17e-38   1.00e-37   1.90e-37   4.44e-37   7.97e-34</span></span>
<span><span class="co">#&gt; 2          0          0   3.22e-35   1.02e-34   1.94e-34   4.63e-34   6.16e-31</span></span>
<span><span class="co">#&gt; 3          0          0   3.75e-32   1.18e-31   2.27e-31   5.57e-31   5.40e-28</span></span>
<span><span class="co">#&gt; 4          0          0   1.84e-30   5.81e-30   1.12e-29   2.80e-29   2.26e-26</span></span>
<span><span class="co">#&gt; 5          0          0   2.20e-28   6.93e-28   1.35e-27   3.47e-27   2.17e-24</span></span>
<span><span class="co">#&gt; 6          0          0   1.75e-26   5.52e-26   1.09e-25   2.90e-25   1.37e-22</span></span>
<span><span class="co">#&gt;   t_09.00.00 t_10.00.00 t_11.00.00 t_12.00.00 t_13.00.00 t_14.00.00 t_15.00.00</span></span>
<span><span class="co">#&gt; 1   3.54e-29   2.17e-26   6.85e-25   2.05e-24   6.97e-25   2.26e-26   3.79e-29</span></span>
<span><span class="co">#&gt; 2   1.04e-26   3.66e-24   8.58e-23   2.34e-22   8.73e-23   3.79e-24   1.11e-26</span></span>
<span><span class="co">#&gt; 3   3.42e-24   6.75e-22   1.17e-20   2.91e-20   1.19e-20   6.98e-22   3.62e-24</span></span>
<span><span class="co">#&gt; 4   8.17e-23   1.16e-20   1.69e-19   3.97e-19   1.72e-19   1.20e-20   8.62e-23</span></span>
<span><span class="co">#&gt; 5   3.72e-21   3.41e-19   3.95e-18   8.63e-18   4.01e-18   3.51e-19   3.90e-21</span></span>
<span><span class="co">#&gt; 6   1.08e-19   6.34e-18   5.79e-17   1.17e-16   5.86e-17   6.50e-18   1.13e-19</span></span>
<span><span class="co">#&gt;   t_16.00.00 t_17.00.00 t_18.00.00 t_19.00.00 t_20.00.00 t_21.00.00 t_22.00.00</span></span>
<span><span class="co">#&gt; 1   8.94e-34   4.49e-37   1.91e-37   1.01e-37   3.22e-38          0          0</span></span>
<span><span class="co">#&gt; 2   6.84e-31   4.69e-34   1.95e-34   1.02e-34   3.28e-35          0          0</span></span>
<span><span class="co">#&gt; 3   5.93e-28   5.64e-31   2.29e-31   1.19e-31   3.81e-32          0          0</span></span>
<span><span class="co">#&gt; 4   2.46e-26   2.83e-29   1.13e-29   5.84e-30   1.87e-30          0          0</span></span>
<span><span class="co">#&gt; 5   2.35e-24   3.51e-27   1.36e-27   6.97e-28   2.24e-28          0          0</span></span>
<span><span class="co">#&gt; 6   1.47e-22   2.94e-25   1.10e-25   5.56e-26   1.78e-26          0          0</span></span>
<span><span class="co">#&gt;   t_23.00.00</span></span>
<span><span class="co">#&gt; 1          0</span></span>
<span><span class="co">#&gt; 2          0</span></span>
<span><span class="co">#&gt; 3          0</span></span>
<span><span class="co">#&gt; 4          0</span></span>
<span><span class="co">#&gt; 5          0</span></span>
<span><span class="co">#&gt; 6          0</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Calculate the value of P<sub>abs</sub> for the PAH of interest, using the results of the TUV model run:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">Pabs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/p_abs.html">p_abs</a></span><span class="op">(</span><span class="va">irrad</span>, <span class="st">"Anthracene"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 451.0696</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Finally, calculate the PLC50 for the PAH of interest</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plc50.html">plc50</a></span><span class="op">(</span><span class="va">Pabs</span>, pah <span class="op">=</span> <span class="st">"Anthracene"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.128409</span></span></code></pre></div>
<p>We can compare the PLC50 to the NLC50 to see the effect of the photoxicity of the PAH:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/nlc50.html">nlc50</a></span><span class="op">(</span><span class="st">"Anthracene"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 58.40685</span></span></code></pre></div>
<div class="section level3">
<h3 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h3>
<p>pahwq creates a directory on your computer to store the TUV model input and output files. By default, the location of this is set automatically to a standard location (determined by <code><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">tools::R_user_dir</a></code>). You can change the location of this directory by setting the <code>pahwq.tuv_data_dir</code> option:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"pahwq.tuv_data_dir"</span> <span class="op">=</span> <span class="st">"path/to/my/tuv/data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-the-tuv-model-step-by-step">Running the TUV model step-by-step<a class="anchor" aria-label="anchor" href="#running-the-tuv-model-step-by-step"></a>
</h3>
<p>Step 2 above can be broken down if you desire to inspect each phase of running the TUV model:</p>
<ol style="list-style-type: decimal">
<li>Set the options for the TUV model run:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/set_tuv_aq_params.html">set_tuv_aq_params</a></span><span class="op">(</span></span>
<span>  depth_m <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  lat <span class="op">=</span> <span class="fl">49.601632</span>,</span>
<span>  lon <span class="op">=</span> <span class="op">-</span><span class="fl">119.605862</span>,</span>
<span>  DOC <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2023-06-21"</span>,</span>
<span>  tzone <span class="op">=</span> <span class="op">-</span><span class="fl">8L</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Run the TUV model</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/run_tuv.html">run_tuv</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Get the results of the TUV model run, as a data.frame of incident irradiation at each timestamp and wavelength, at the given water depth at your location:</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_tuv_results.html">get_tuv_results</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"out_irrad_y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">irrad</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wl wavelength_start wavelength_end Kd_lambda t_00.00.00 t_01.00.00</span></span>
<span><span class="co">#&gt; 1 280            279.5          280.5      31.5          0          0</span></span>
<span><span class="co">#&gt; 2 281            280.5          281.5      31.0          0          0</span></span>
<span><span class="co">#&gt; 3 282            281.5          282.5      30.4          0          0</span></span>
<span><span class="co">#&gt; 4 283            282.5          283.5      29.9          0          0</span></span>
<span><span class="co">#&gt; 5 284            283.5          284.5      29.3          0          0</span></span>
<span><span class="co">#&gt; 6 285            284.5          285.5      28.8          0          0</span></span>
<span><span class="co">#&gt;   t_02.00.00 t_03.00.00 t_04.00.00 t_05.00.00 t_06.00.00 t_07.00.00 t_08.00.00</span></span>
<span><span class="co">#&gt; 1          0          0   3.17e-38   1.00e-37   1.90e-37   4.44e-37   7.97e-34</span></span>
<span><span class="co">#&gt; 2          0          0   3.22e-35   1.02e-34   1.94e-34   4.63e-34   6.16e-31</span></span>
<span><span class="co">#&gt; 3          0          0   3.75e-32   1.18e-31   2.27e-31   5.57e-31   5.40e-28</span></span>
<span><span class="co">#&gt; 4          0          0   1.84e-30   5.81e-30   1.12e-29   2.80e-29   2.26e-26</span></span>
<span><span class="co">#&gt; 5          0          0   2.20e-28   6.93e-28   1.35e-27   3.47e-27   2.17e-24</span></span>
<span><span class="co">#&gt; 6          0          0   1.75e-26   5.52e-26   1.09e-25   2.90e-25   1.37e-22</span></span>
<span><span class="co">#&gt;   t_09.00.00 t_10.00.00 t_11.00.00 t_12.00.00 t_13.00.00 t_14.00.00 t_15.00.00</span></span>
<span><span class="co">#&gt; 1   3.54e-29   2.17e-26   6.85e-25   2.05e-24   6.97e-25   2.26e-26   3.79e-29</span></span>
<span><span class="co">#&gt; 2   1.04e-26   3.66e-24   8.58e-23   2.34e-22   8.73e-23   3.79e-24   1.11e-26</span></span>
<span><span class="co">#&gt; 3   3.42e-24   6.75e-22   1.17e-20   2.91e-20   1.19e-20   6.98e-22   3.62e-24</span></span>
<span><span class="co">#&gt; 4   8.17e-23   1.16e-20   1.69e-19   3.97e-19   1.72e-19   1.20e-20   8.62e-23</span></span>
<span><span class="co">#&gt; 5   3.72e-21   3.41e-19   3.95e-18   8.63e-18   4.01e-18   3.51e-19   3.90e-21</span></span>
<span><span class="co">#&gt; 6   1.08e-19   6.34e-18   5.79e-17   1.17e-16   5.86e-17   6.50e-18   1.13e-19</span></span>
<span><span class="co">#&gt;   t_16.00.00 t_17.00.00 t_18.00.00 t_19.00.00 t_20.00.00 t_21.00.00 t_22.00.00</span></span>
<span><span class="co">#&gt; 1   8.94e-34   4.49e-37   1.91e-37   1.01e-37   3.22e-38          0          0</span></span>
<span><span class="co">#&gt; 2   6.84e-31   4.69e-34   1.95e-34   1.02e-34   3.28e-35          0          0</span></span>
<span><span class="co">#&gt; 3   5.93e-28   5.64e-31   2.29e-31   1.19e-31   3.81e-32          0          0</span></span>
<span><span class="co">#&gt; 4   2.46e-26   2.83e-29   1.13e-29   5.84e-30   1.87e-30          0          0</span></span>
<span><span class="co">#&gt; 5   2.35e-24   3.51e-27   1.36e-27   6.97e-28   2.24e-28          0          0</span></span>
<span><span class="co">#&gt; 6   1.47e-22   2.94e-25   1.10e-25   5.56e-26   1.78e-26          0          0</span></span>
<span><span class="co">#&gt;   t_23.00.00</span></span>
<span><span class="co">#&gt; 1          0</span></span>
<span><span class="co">#&gt; 2          0</span></span>
<span><span class="co">#&gt; 3          0</span></span>
<span><span class="co">#&gt; 4          0</span></span>
<span><span class="co">#&gt; 5          0</span></span>
<span><span class="co">#&gt; 6          0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-photoxicity-for-multiple-chemicals">Calculating photoxicity for multiple chemicals<a class="anchor" aria-label="anchor" href="#calculating-photoxicity-for-multiple-chemicals"></a>
</h3>
<p>If you want to calculate PLC50 for several chemicals at a particular site, you can use the <code><a href="reference/plc50_multi.html">plc50_multi()</a></code> function.</p>
<p>First, you must calculate the absorption with <code><a href="reference/tuv.html">tuv()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tuv.html">tuv</a></span><span class="op">(</span></span>
<span>  depth_m <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  lat <span class="op">=</span> <span class="fl">49.601632</span>,</span>
<span>  lon <span class="op">=</span> <span class="op">-</span><span class="fl">119.605862</span>,</span>
<span>  DOC <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2023-06-21"</span>,</span>
<span>  tzone <span class="op">=</span> <span class="op">-</span><span class="fl">8L</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then, use the results from the TUV model run and a vector of chemical names:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plc50_multi.html">plc50_multi</a></span><span class="op">(</span><span class="va">irrad</span>, pahs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Anthracene"</span>, <span class="st">"Benzo(a)pyrene"</span>, <span class="st">"Fluorene"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              pah      nlc50         pabs       plc50</span></span>
<span><span class="co">#&gt; 1     anthracene  58.406846 4.510696e+02  2.12840933</span></span>
<span><span class="co">#&gt; 2 benzo(a)pyrene   1.832461 2.336815e+03  0.03375568</span></span>
<span><span class="co">#&gt; 3       fluorene 111.266961 2.201839e-02 80.32970027</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sensitivity-to-kd-depth-and-time-of-year">Sensitivity to Kd, depth, and time of year<a class="anchor" aria-label="anchor" href="#sensitivity-to-kd-depth-and-time-of-year"></a>
</h3>
<p>Use the function <code><a href="reference/sens_kd_depth.html">sens_kd_depth()</a></code> to investigate the sensitivity of a given PAH at a location to light attenuation (<code>DOC</code> or <code>Kd</code>) and depth over a set of dates.</p>
<p>There is also a plotting function, <code><a href="reference/plot_sens_kd_depth.html">plot_sens_kd_depth()</a></code> to make a static or interactive heat map of the analysis.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># varying DOC</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sens_kd_depth.html">sens_kd_depth</a></span><span class="op">(</span></span>
<span>  <span class="st">"Anthracene"</span>,</span>
<span>  lat <span class="op">=</span> <span class="fl">52</span>,</span>
<span>  lon <span class="op">=</span> <span class="op">-</span><span class="fl">113</span>,</span>
<span>  DOC <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  depth_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-07-01"</span>, <span class="st">"2023-08-01"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 11</span></span>
<span><span class="co">#&gt;     lat   lon elev_m depth_m date         DOC tuv_res    pah   nlc50  pabs plc50</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;int&gt; &lt;list&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1    52  -113    880    0.25 2023-07-01     3 &lt;tv_rslts&gt; anth…  58.4 1068.  1.49</span></span>
<span><span class="co">#&gt; 2    52  -113    880    0.5  2023-07-01     3 &lt;tv_rslts&gt; anth…  58.4  370.  2.31</span></span>
<span><span class="co">#&gt; 3    52  -113    880    0.25 2023-08-01     3 &lt;tv_rslts&gt; anth…  58.4  912.  1.59</span></span>
<span><span class="co">#&gt; 4    52  -113    880    0.5  2023-08-01     3 &lt;tv_rslts&gt; anth…  58.4  313.  2.47</span></span>
<span><span class="co">#&gt; 5    52  -113    880    0.25 2023-07-01     4 &lt;tv_rslts&gt; anth…  58.4  675.  1.80</span></span>
<span><span class="co">#&gt; 6    52  -113    880    0.5  2023-07-01     4 &lt;tv_rslts&gt; anth…  58.4  162.  3.23</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_sens_kd_depth.html">plot_sens_kd_depth</a></span><span class="op">(</span><span class="va">out</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="100%"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Varying Kd_ref</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sens_kd_depth.html">sens_kd_depth</a></span><span class="op">(</span></span>
<span>  <span class="st">"benzo(a)pyrene"</span>,</span>
<span>  lat <span class="op">=</span> <span class="fl">57</span>,</span>
<span>  lon <span class="op">=</span> <span class="op">-</span><span class="fl">120</span>,</span>
<span>  Kd_ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  depth_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-05-01"</span>, <span class="st">"2023-07-01"</span>, <span class="st">"2023-09-01"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_sens_kd_depth.html">plot_sens_kd_depth</a></span><span class="op">(</span><span class="va">out2</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-14-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="calculating-pabs-and-plc50-with-experimental-data">Calculating Pabs and PLC50 with experimental data<a class="anchor" aria-label="anchor" href="#calculating-pabs-and-plc50-with-experimental-data"></a>
</h3>
<p>If you have experimentally obtained data with a measured irradiance across a range of wavelengths, you can calculate Pabs using <code><a href="reference/P_abs_single.html">p_abs_single()</a></code> on a 2-column data.frame. The first column must contain wavelengths and be called <code>wl</code>, and the second column contains irradiance values. Irradiance values must be in units of <code>"uW / cm^2 / nm"</code> (default) or <code>"W / m^2 / nm"</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irrad_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"my-irrad-data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">irrad_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wl          i</span></span>
<span><span class="co">#&gt; 1 280 0.05500000</span></span>
<span><span class="co">#&gt; 2 281 0.05000000</span></span>
<span><span class="co">#&gt; 3 282 0.04666667</span></span>
<span><span class="co">#&gt; 4 283 0.04000000</span></span>
<span><span class="co">#&gt; 5 284 0.06000000</span></span>
<span><span class="co">#&gt; 6 285 0.05500000</span></span>
<span></span>
<span><span class="fu"><a href="reference/P_abs_single.html">p_abs_single</a></span><span class="op">(</span><span class="va">irrad_df</span>, pah <span class="op">=</span> <span class="st">"anthracene"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.027156</span></span></code></pre></div>
<p>To simulate this exposure for a period of time (say 16 hours of daylight over a two-day period), use the <code>time_multiplier</code> argument to get the Pabs for the full exposure time. E.g., if the exposure was one second, and you need a 16h exposure, the multiplier would be 3600 s in 1h * 16 h (= 57600).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/P_abs_single.html">p_abs_single</a></span><span class="op">(</span><span class="va">irrad_df</span>, pah <span class="op">=</span> <span class="st">"anthracene"</span>, time_multiplier <span class="op">=</span> <span class="fl">3600</span> <span class="op">*</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1564.17</span></span></code></pre></div>
<p>You can then use this value to calculate PLC50 with the <code><a href="reference/plc50.html">plc50()</a></code> function. You can either supply an NLC50 value directly, or allow the function to look up the NLC50 for the chemical supplied:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the Pabs for the simulated exposure:</span></span>
<span><span class="va">p_abs_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/P_abs_single.html">p_abs_single</a></span><span class="op">(</span><span class="va">irrad_df</span>, pah <span class="op">=</span> <span class="st">"anthracene"</span>, time_multiplier <span class="op">=</span> <span class="fl">3600</span> <span class="op">*</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the PLC50:</span></span>
<span><span class="fu"><a href="reference/plc50.html">plc50</a></span><span class="op">(</span><span class="va">p_abs_exp</span>, NLC50 <span class="op">=</span> <span class="fl">58.4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.272051</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-help-or-reporting-an-issue">Getting Help or Reporting an Issue<a class="anchor" aria-label="anchor" href="#getting-help-or-reporting-an-issue"></a>
</h2>
<p>To report bugs/issues/feature requests, please file an <a href="https://github.com/bcgov/pahwq/issues/" class="external-link">issue</a>.</p>
</div>
<div class="section level2">
<h2 id="how-to-contribute">How to Contribute<a class="anchor" aria-label="anchor" href="#how-to-contribute"></a>
</h2>
<p>If you would like to contribute to the package, please see our <a href="CONTRIBUTING.html">CONTRIBUTING</a> guidelines.</p>
<p>Please note that this project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>Copyright <span class="dv">2023</span> Province of British Columbia</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>Licensed under the Apache License, Version <span class="fl">2.0</span> (the <span class="sc">&amp;</span>quot;License<span class="sc">&amp;</span>quot;);</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>you may not use this file except <span class="cf">in</span> compliance with the License.</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>You may obtain a copy of the License at</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>http<span class="sc">:</span><span class="er">//</span>www.apache.org<span class="sc">/</span>licenses<span class="sc">/</span>LICENSE<span class="fl">-2.0</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>Unless required by applicable law or agreed to <span class="cf">in</span> writing, software distributed under the License is distributed on an <span class="sc">&amp;</span>quot;AS IS<span class="sc">&amp;</span>quot; BASIS,</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>See the License <span class="cf">for</span> the specific language governing permissions and limitations under the License.</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/bcgov/pahwq/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/bcgov/pahwq/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing pahwq</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Andy Teucher <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7840-692X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/bcgov/repomountie/blob/master/doc/lifecycle-badges.md" class="external-link"><img src="https://img.shields.io/badge/Lifecycle-Maturing-007EC6" alt="img"></a></li>
<li><a href="https://github.com/bcgov/pahwq/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/bcgov/pahwq/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/bcgov/pahwq?branch=main" class="external-link"><img src="https://codecov.io/gh/bcgov/pahwq/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andy Teucher.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
